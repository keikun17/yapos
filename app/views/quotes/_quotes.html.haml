%table.table.table-condensed.quotes-table
  %thead
    %tr
      %th.reference Client PR#
      - unless params[:controller] == 'clients'
        %th.client-name Client Name
      %th.request-date Client Requested At
      %th.requested-item Requested Items
      %th.supplier-name Supplier
      %th.status Status
      %th.po-reference Client PO
      - if defined?(show_actions)
        %th.actions Actions
  %tbody
    - quotes.each do |quote|
      %tr{:class => quote_row_class(quote)}
        %td
          %strong= link_to quote.display_reference, quote
        - unless params[:controller] == 'clients'
          %td= link_to_client(quote.client)
        %td= quote.quote_date.to_date if quote.quote_date
        %td
          - if !quote.title.blank? and !quote.requests.empty?
            %strong= truncate(quote.title, :length => 40, :omission => "...")
          - quote.requests.decorate.each do |request|
            %p
              %span.request-quantity= request.display_quantity
              - if !request.item_code.blank?
                %span.client-item-code
                  Item Code :
                  = request.item_code
              = truncate(request.specs, length: 200)
              - delivery_dates = request.offers.map{|offer| offer.supplier_order_delivered_at }.compact 
              - if quote.awarded?
                - if !delivery_dates.empty?
                  %span.label.label-success Delivered at :#{delivery_dates.map(&:to_date).join(',')}
                - else
                  %span.label.label-warning Not yet delivered

        %td= supplier_links(quote)
        %td= quote.display_status
        %td
          = quote.order_links_with_date

        - if defined?(show_actions)
          %td
            = link_to t('.edit', :default => t("helpers.links.edit")), edit_quote_path(quote), :class => 'btn btn-mini'
            =# link_to 'Requote', requote_quote_path(quote),  :class => 'btn btn-mini'
            = link_to t('.destroy', :default => t("helpers.links.destroy")), quote_path(quote), :method => :delete, :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) }, :class => 'btn btn-mini btn-danger'

